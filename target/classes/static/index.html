<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Private Page</title>
  <style>
    body { margin: 0; font-family: sans-serif; background-color: #111; color: #fff; }

    #password-gate {
      position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
      background-color: #000; display: flex; justify-content: center;
      align-items: center; flex-direction: column; z-index: 100;
    }

    #content-feed { display: none; padding-top: 20px; }
    #media-container { max-width: 800px; margin: 0 auto; }

    .media-item {
      margin-bottom: 40px;
      border-bottom: 1px solid #333;
      padding-bottom: 20px;
    }
    .media-item img, .media-item video {
      /* --- CSS FIX --- */
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      display: block; /* Fixes potential spacing issues */
      margin: 0 auto;
    }

    .media-item video {
      max-height: 80vh;   /* <-- THIS IS THE NEW FIX */
    }

    /* Navigation Bar Style */
    .nav-bar {
      background-color: #222;
      padding: 15px;
      text-align: center;
      width: 100%;
    }
    .nav-bar a {
      color: #00aaff;
      font-size: 18px;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="password-gate">
  <h2>Enter Password</h2>
  <input type="password" id="password-input" />
  <button id="login-button">Enter</button>
  <p id="error-message" style="color: red;"></p>
</div>

<div id="content-feed">
  <div id="media-container" style="padding-top: 30px;">
  </div>
</div>

<script>
  const gate = document.getElementById('password-gate');
  const feed = document.getElementById('content-feed');
  const loginButton = document.getElementById('login-button');
  const passwordInput = document.getElementById('password-input');
  const errorMessage = document.getElementById('error-message');
  const mediaContainer = document.getElementById('media-container');

  // --- checkPassword function is UNCHANGED ---
  async function checkPassword() {
    const password = passwordInput.value;
    try {
      const response = await fetch('/api/authenticate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: password })
      });
      if (response.ok) {
        gate.style.display = 'none';
        feed.style.display = 'block';
        loadMedia(); // Load content after login
      } else {
        errorMessage.textContent = 'Incorrect Password';
      }
    } catch (err) {
      errorMessage.textContent = 'Error contacting server.';
    }
  }

  loginButton.addEventListener('click', checkPassword);
  passwordInput.addEventListener('keyup', (event) => {
    if (event.key === 'Enter') checkPassword();
  });

  // --- loadMedia function is UNCHANGED ---
  async function loadMedia() {
    try {
      const response = await fetch('/api/media');
      if (!response.ok) {
        gate.style.display = 'flex';
        feed.style.display = 'none';
        return;
      }

      const mediaItems = await response.json();
      mediaContainer.innerHTML = ''; // Clear existing

      for (const item of mediaItems) {
        const div = document.createElement('div');
        div.className = 'media-item';

        // Check if mediaUrl is present
        if (item.mediaUrl) {
          if (item.mediaType.startsWith('image')) {
            div.innerHTML = `<img src="${item.mediaUrl}" alt="Media">`;
          } else if (item.mediaType.startsWith('video')) {
            div.innerHTML = `<video src="${item.mediaUrl}" controls></video>`;
          }
        }
        mediaContainer.appendChild(div);
      }
    } catch (err) {
      console.error('Failed to load media:', err);
    }
  }

  // --- UPLOAD FORM SCRIPT IS REMOVED ---

</script>
</body>
</html>